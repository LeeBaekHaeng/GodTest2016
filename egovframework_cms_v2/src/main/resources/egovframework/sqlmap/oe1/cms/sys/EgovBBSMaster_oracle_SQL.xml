<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="BBSLoneMaster">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="BoardMasterVO" type="egovframework.oe1.cms.sys.service.EgovOe1BoardMasterVO"/>
	<typeAlias  alias="BoardMaster" type="egovframework.oe1.cms.sys.service.EgovOe1BoardMaster"/>

	<resultMap id="boardMasterList" class="egovframework.oe1.cms.sys.service.EgovOe1BoardMasterVO">
		<result property="bbsId" column="BBS_ID" columnIndex="1"/>
		<result property="bbsTyCode" column="BBS_TY_CODE" columnIndex="2"/>
		<result property="bbsTyCodeNm" column="BBS_TY_CODE_NM" columnIndex="3"/>
		<result property="bbsAttrbCode" column="BBS_ATTRB_CODE" columnIndex="4"/>
		<result property="bbsAttrbCodeNm" column="BBS_ATTRB_CODE_NM" columnIndex="5"/>
		<result property="bbsNm" column="BBS_NM" columnIndex="6"/>
		<result property="tmplatId" column="TMPLAT_ID" columnIndex="7"/>
		<result property="useAt" column="USE_AT" columnIndex="8"/>
		<result property="frstRegisterPnttm" column="FRST_REGISTER_PNTTM" columnIndex="9"/>
	</resultMap>

	<resultMap id="boardMasterDetail" class="egovframework.oe1.cms.sys.service.EgovOe1BoardMasterVO">
		<result property="bbsId" column="BBS_ID" columnIndex="1"/>
		<result property="bbsTyCode" column="BBS_TY_CODE" columnIndex="2"/>
		<result property="bbsAttrbCode" column="BBS_ATTRB_CODE" columnIndex="3"/>
		<result property="bbsNm" column="BBS_NM" columnIndex="4"/>
		<result property="bbsIntrcn" column="BBS_INTRCN" columnIndex="5"/>
		<result property="replyPosblAt" column="REPLY_POSBL_AT" columnIndex="6"/>
		<result property="fileAtchPosblAt" column="FILE_ATCH_POSBL_AT" columnIndex="7"/>
		<result property="posblAtchFileNumber" column="POSBL_ATCH_FILE_NUMBER" columnIndex="8"/>
		<result property="posblAtchFileSize" column="POSBL_ATCH_FILE_SIZE" columnIndex="9"/>
		<!-- result property="tmplatId" column="TMPLAT_ID" columnIndex="10"/ -->
		<result property="frstRegisterId" column="FRST_REGISTER_ID" columnIndex="10"/>
		<result property="frstRegisterNm" column="FRST_REGISTER_NM" columnIndex="11"/>
		<result property="frstRegisterPnttm" column="FRST_REGISTER_PNTTM" columnIndex="12"/>
		<result property="bbsTyCodeNm" column="BBS_TY_CODE_NM" columnIndex="13"/>
		<result property="bbsAttrbCodeNm" column="BBS_ATTRB_CODE_NM" columnIndex="14"/>
 	    <!-- result property="tmplatNm" column="TMPLAT_NM" columnIndex="16"/ -->
		<result property="authFlag" column="AUTH_FLAG" columnIndex="15"/>
		<result property="useAt" column="USE_AT" columnIndex="16"/>
		<!-- result property="tmplatCours" column="TMPLAT_COURS" columnIndex="18"/ -->
	</resultMap>

	<resultMap id="boardMasterAll" class="egovframework.oe1.cms.sys.service.EgovOe1BoardMasterVO">
		<result property="bbsId" column="BBS_ID" columnIndex="1"/>
		<result property="bbsTyCode" column="BBS_TY_CODE" columnIndex="2"/>
		<result property="bbsAttrbCode" column="BBS_ATTRB_CODE" columnIndex="3"/>
		<result property="bbsNm" column="BBS_NM" columnIndex="4"/>
		<result property="tmplatId" column="TMPLAT_ID" columnIndex="5"/>
	</resultMap>

	<insert id="BBSLoneMasterDAO.insertMaster" parameterClass="BoardMaster" >
		<![CDATA[
			INSERT INTO OE1TNBBSMASTER
					(BBS_ID, BBS_TY_CODE, BBS_ATTRB_CODE, BBS_NM, BBS_INTRCN, 
					 REPLY_POSBL_AT, FILE_ATCH_POSBL_AT, POSBL_ATCH_FILE_NUMBER,
					 POSBL_ATCH_FILE_SIZE, TMPLAT_ID, USE_AT,
					 FRST_REGISTER_ID, FRST_REGISTER_PNTTM, LAST_UPDUSR_ID,	LAST_UPDUSR_PNTTM)
			VALUES
			( #bbsId#, #bbsTyCode#, #bbsAttrbCode#, #bbsNm#, #bbsIntrcn#, 
			  #replyPosblAt#, #fileAtchPosblAt#, #posblAtchFileNumber#, 
			  #posblAtchFileSize#, #tmplatId#, #useAt#, #frstRegisterId#, SYSDATE,  #lastUpdusrId#,  SYSDATE
			 )			
		]]>
	</insert>
	
	<select id="BBSLoneMasterDAO.selectMasterList" parameterClass="BoardMasterVO" resultMap="boardMasterList" >
        <![CDATA[
            SELECT  *
              FROM  (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM  (
        ]]>
        
        /* 구현 Sql */
		<![CDATA[
			SELECT 
				a.BBS_ID, a.BBS_TY_CODE, b.CODE_NM as BBS_TY_CODE_NM,
				a.BBS_ATTRB_CODE, c.CODE_NM as BBS_ATTRB_CODE_NM, a.BBS_NM, 
				a.TMPLAT_ID, a.USE_AT, 
				TO_CHAR(a.FRST_REGISTER_PNTTM, 'YYYY-MM-DD') as FRST_REGISTER_PNTTM
			FROM
				OE1TNBBSMASTER a
			INNER JOIN
				OE1TNBBSUSE z
				ON (a.BBS_ID = z.BBS_ID AND z.REGIST_SE_CODE = 'REGC01')
			LEFT OUTER JOIN 
				(SELECT CODE_ID, CODE, CODE_NM FROM 
					OE1TNOECOMMDETAILCD WHERE CODE_ID = 'OE1014' AND USE_AT='Y') b
				ON a.BBS_TY_CODE = b.CODE
			LEFT OUTER JOIN 
				(SELECT CODE_ID, CODE, CODE_NM FROM 
					OE1TNOECOMMDETAILCD WHERE CODE_ID = 'OE1015' AND USE_AT='Y') c
				ON a.BBS_ATTRB_CODE = c.CODE
			WHERE 1=1	
		]]>
			<isNotEmpty property="useAt">
				AND a.USE_AT = #useAt#
			</isNotEmpty>
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	a.BBS_NM LIKE CONCAT(CONCAT('%', #searchWrd#), '%') 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	b.CODE_NM LIKE CONCAT(CONCAT('%', #searchWrd#), '%') 		]]>
			</isEqual>	
			ORDER BY a.FRST_REGISTER_PNTTM DESC 
        /* 구현 Sql */
        
        <![CDATA[
                    ) ALL_LIST
                    )
             WHERE  RNUM  > #firstIndex#
               AND  RNUM <= #firstIndex# + #recordCountPerPage#
        ]]>	

	</select>	
	
	<select id="BBSLoneMasterDAO.selectMasterListCnt" parameterClass="BoardMasterVO" resultClass="java.lang.Integer" >
		<![CDATA[
			SELECT 
				COUNT(a.BBS_ID) AS cnt
			FROM
				OE1TNBBSMASTER a
			INNER JOIN
				OE1TNBBSUSE z
				ON (a.BBS_ID = z.BBS_ID AND z.REGIST_SE_CODE = 'REGC01')
			LEFT OUTER JOIN 
				(SELECT CODE_ID, CODE, CODE_NM FROM 
					OE1TNOECOMMDETAILCD WHERE CODE_ID = 'COM004' AND USE_AT='Y') b
				ON a.BBS_TY_CODE = b.CODE
			LEFT OUTER JOIN 
				(SELECT CODE_ID, CODE, CODE_NM FROM 
					OE1TNOECOMMDETAILCD WHERE CODE_ID = 'OE1015' AND USE_AT='Y') c
				ON a.BBS_ATTRB_CODE = c.CODE
			WHERE 1=1 
		]]>
			<isNotEmpty property="useAt">
				AND a.USE_AT = #useAt#
			</isNotEmpty>
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	a.BBS_NM LIKE CONCAT(CONCAT('%', #searchWrd#), '%') 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	b.CODE_NM LIKE CONCAT(CONCAT('%', #searchWrd#), '%') 		]]>
			</isEqual>	
	</select>	
 
	<select id="BBSLoneMasterDAO.selectMaster" parameterClass="BoardMaster" resultMap="boardMasterDetail" >
		<![CDATA[
			SELECT 
				a.BBS_ID, a.BBS_TY_CODE, b.CODE_NM as BBS_TY_CODE_NM, a.BBS_INTRCN, 
				a.BBS_ATTRB_CODE, c.CODE_NM as BBS_ATTRB_CODE_NM, a.BBS_NM, 
				a.FILE_ATCH_POSBL_AT, a.POSBL_ATCH_FILE_NUMBER,
				a.POSBL_ATCH_FILE_SIZE, a.REPLY_POSBL_AT, a.FRST_REGISTER_ID, e.MBER_NM as FRST_REGISTER_NM,
				a.USE_AT, TO_CHAR(a.FRST_REGISTER_PNTTM, 'YYYY-MM-DD') as FRST_REGISTER_PNTTM				
				,(SELECT NVL(USE_AT,'N') FROM OE1TNBBSUSE 
					WHERE BBS_ID = #bbsId# 
					AND TRGET_ID IN (#mberId#, 'SYSTEM_DEFAULT_BOARD')
				) as AUTH_FLAG
				
			FROM
				OE1TNBBSMASTER a
			LEFT OUTER JOIN 
				(SELECT CODE_ID, CODE, CODE_NM FROM OE1TNOECOMMDETAILCD WHERE CODE_ID = 'OE1014' AND USE_AT='Y') b
				ON a.BBS_TY_CODE = b.CODE
			LEFT OUTER JOIN 
				(SELECT CODE_ID, CODE, CODE_NM FROM OE1TNOECOMMDETAILCD WHERE CODE_ID = 'OE1015' AND USE_AT='Y') c
				ON a.BBS_ATTRB_CODE = c.CODE
			LEFT OUTER JOIN OE1TNUSERINFO e
				ON a.FRST_REGISTER_ID = e.MBER_ID		
			WHERE a.BBS_ID = #bbsId#
		]]>				
	</select> 
 
 	<update id="BBSLoneMasterDAO.updateMaster" parameterClass="BoardMaster">
 		<![CDATA[
			UPDATE OE1TNBBSMASTER SET 
				BBS_NM = #bbsNm#,
				BBS_INTRCN = #bbsIntrcn#, 
				FILE_ATCH_POSBL_AT = #fileAtchPosblAt#,
				POSBL_ATCH_FILE_NUMBER = #posblAtchFileNumber#,
				POSBL_ATCH_FILE_SIZE = #posblAtchFileSize#,
				TMPLAT_ID = #tmplatId#,		
				LAST_UPDUSR_ID = #lastUpdusrId#,
				LAST_UPDUSR_PNTTM = SYSDATE
			WHERE BBS_ID = #bbsId#
 		]]>
 	</update>

 	<update id="BBSLoneMasterDAO.deleteMaster" parameterClass="BoardMaster">
 		<![CDATA[
			UPDATE OE1TNBBSMASTER SET 
				USE_AT = 'N',
				LAST_UPDUSR_ID = #lastUpdusrId#,
				LAST_UPDUSR_PNTTM = SYSDATE
			WHERE BBS_ID = #bbsId#
 		]]>
 	</update>

</sqlMap>
